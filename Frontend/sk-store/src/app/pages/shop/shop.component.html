<!-- src/app/pages/shop/shop.component.html -->
<main class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Breadcrumb -->
        <nav class="flex items-center text-sm text-gray-600 mb-8 bg-white rounded-lg px-4 py-3 shadow-sm">
            <a routerLink="/" class="hover:text-blue-600 transition-colors duration-200 flex items-center">
                <i class="fas fa-home mr-1"></i>
                Trang chủ
            </a>
            <span class="mx-3 text-gray-400">/</span>
            <span class="text-gray-800 font-medium flex items-center">
                <i class="fas fa-store mr-1"></i>
                Cửa hàng
            </span>
        </nav>

        <!-- Product Header -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div class="mb-4 md:mb-0">
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                        Tất cả sản phẩm
                    </h1>
                    <p class="text-gray-600">Khám phá bộ sưu tập đa dạng của chúng tôi</p>
                </div>
                <div class="flex items-center bg-gray-50 rounded-lg px-4 py-2">
                    <span class="mr-3 text-gray-700 font-medium flex items-center">
                        <i class="fas fa-sort mr-2"></i>
                        Sắp xếp:
                    </span>
                    <select class="bg-white border-2 border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 shadow-sm">
                        <option>Phổ biến</option>
                        <option>Giá: Thấp đến cao</option>
                        <option>Giá: Cao đến thấp</option>
                        <option>Mới nhất</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Sidebar Filters -->
            <aside class="w-full lg:w-80 space-y-6">
                <!-- **** THÊM KHỐI TÌM KIẾM DƯỚI ĐÂY **** -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-search text-blue-500 mr-3"></i>
                        Tìm kiếm
                    </h2>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-4">
                            <i class="fas fa-search text-gray-400"></i>
                        </span>
                        <input 
                            type="text" 
                            placeholder="Nhập tên sản phẩm..."
                            (input)="onSearch($event)"
                            class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 hover:bg-white"
                        >
                    </div>
                </div>
                <!-- **** KẾT THÚC KHỐI TÌM KIẾM **** -->

                <!-- Categories -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-layer-group text-green-500 mr-3"></i>
                        Danh mục
                    </h2>
                    <div class="space-y-2">
                        <button (click)="setCategoryFilter(null)"
                                [class.text-blue-600]="activeCategoryId() === null"
                                [class.bg-blue-50]="activeCategoryId() === null"
                                [class.border-blue-200]="activeCategoryId() === null"
                                [class.font-semibold]="activeCategoryId() === null"
                                class="w-full text-left text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-all duration-200 border border-transparent">
                            <i class="fas fa-th-large mr-2"></i>
                            Tất cả
                        </button>
                        @for (category of categories(); track category.categoryId) {
                            <button (click)="setCategoryFilter(category.categoryId)"
                                    [class.text-blue-600]="activeCategoryId() === category.categoryId"
                                    [class.bg-blue-50]="activeCategoryId() === category.categoryId"
                                    [class.border-blue-200]="activeCategoryId() === category.categoryId"
                                    [class.font-semibold]="activeCategoryId() === category.categoryId"
                                    class="w-full text-left text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-all duration-200 border border-transparent">
                                <i class="fas fa-tag mr-2"></i>
                                {{ category.categoryName }}
                            </button>
                        }
                    </div>
                </div>

                <!-- Brands -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-star text-yellow-500 mr-3"></i>
                        Thương hiệu
                    </h2>
                    <div class="space-y-2">
                        <button (click)="setBrandFilter(null)"
                                [class.text-blue-600]="activeBrandId() === null"
                                [class.bg-blue-50]="activeBrandId() === null"
                                [class.border-blue-200]="activeBrandId() === null"
                                [class.font-semibold]="activeBrandId() === null"
                                class="w-full text-left text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-all duration-200 border border-transparent">
                            <i class="fas fa-globe mr-2"></i>
                            Tất cả
                        </button>
                        @for (brand of brands(); track brand.brandId) {
                            <button (click)="setBrandFilter(brand.brandId)"
                                    [class.text-blue-600]="activeBrandId() === brand.brandId"
                                    [class.bg-blue-50]="activeBrandId() === brand.brandId"
                                    [class.border-blue-200]="activeBrandId() === brand.brandId"
                                    [class.font-semibold]="activeBrandId() === brand.brandId"
                                    class="w-full text-left text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-all duration-200 border border-transparent">
                                <i class="fas fa-award mr-2"></i>
                                {{ brand.brandName }}
                            </button>
                        }
                    </div>
                </div>
            </aside>

            <!-- Products Grid -->
            <div class="flex-1">
                @if (isLoading() || isFetchingProducts()) {
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-8">
                        <!-- Skeleton Loader -->
                        @for (item of [1,2,3,4,5,6]; track item) {
                            <div class="animate-pulse bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
                                <div class="bg-gradient-to-r from-gray-200 to-gray-300 h-56 w-full"></div>
                                <div class="p-6 space-y-4">
                                    <div class="h-4 bg-gray-200 rounded-full w-1/4"></div>
                                    <div class="h-6 bg-gray-200 rounded-full w-3/4"></div>
                                    <div class="flex justify-between items-center">
                                        <div class="h-8 bg-gray-200 rounded-full w-1/3"></div>
                                        <div class="h-10 w-10 bg-gray-200 rounded-full"></div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                } @else if (error()) {
                    <div class="text-center py-16 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-100">
                        <div class="text-red-500 mb-6">
                            <i class="fas fa-exclamation-triangle text-6xl animate-bounce"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Oops! Có lỗi xảy ra</h3>
                        <p class="text-gray-600 mb-6">{{ error() }}</p>
                        <button (click)="loadInitialData()"
                                class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                            <i class="fas fa-redo mr-2"></i>
                            Thử lại
                        </button>
                    </div>
                } @else {
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-8">
                        @for (product of products(); track product.productId) {
                            <div class="product-card bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col border border-gray-100 group transform hover:-translate-y-2">
                                <div class="relative overflow-hidden">
                                    <a [routerLink]="['/products', product.productId]">
                                        <img [src]="getImageUrl(product.primaryImageUrl)"
                                             [alt]="product.productName"
                                             class="product-image w-full h-56 object-contain p-4 group-hover:scale-105 transition-transform duration-300"
                                             (error)="$any($event.target).src = getImageUrl('')">
                                    </a>
                                    <div class="absolute top-4 right-4">
                                        <button class="w-10 h-10 rounded-full bg-white/90 backdrop-blur-sm shadow-lg flex items-center justify-center text-gray-600 hover:text-red-500 hover:bg-white transition-all duration-200 transform hover:scale-110">
                                            <i class="far fa-heart text-lg"></i>
                                        </button>
                                    </div>
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                </div>
                                <div class="p-6 flex flex-col flex-grow">
                                    <div class="text-sm text-blue-600 mb-2 font-medium bg-blue-50 px-3 py-1 rounded-full inline-block w-fit">{{ product.brandName }}</div>
                                    <h3 class="font-semibold text-gray-800 mb-3 hover:text-blue-600 transition-colors duration-200 flex-grow line-clamp-2">
                                        <a [routerLink]="['/products', product.productId]">{{ product.productName }}</a>
                                    </h3>
                                    <div class="flex items-center justify-between mt-auto">
                                        <span class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">{{product.price | vndCurrency }}</span>
                                        <button class="w-11 h-11 rounded-full bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center text-white hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-110">
                                            <i class="fas fa-shopping-cart text-sm"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (products().length === 0 && !isLoading()) {
                        <div class="text-center py-16 col-span-full bg-gradient-to-br from-gray-50 to-blue-50 rounded-xl border-2 border-gray-100">
                            <div class="text-gray-400 mb-6">
                                <i class="fas fa-box-open text-8xl"></i>
                            </div>
                            <h3 class="text-2xl font-semibold text-gray-700 mb-2">Không tìm thấy sản phẩm</h3>
                            <p class="text-gray-500">Thử thay đổi bộ lọc hoặc từ khóa tìm kiếm của bạn.</p>
                        </div>
                    }
                    @if (totalProducts() > pageSize) {
                      <div class="col-span-full mt-12">
                        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                            <app-pagination
                              [currentPage]="currentPage()"
                              [totalItems]="totalProducts()"
                              [pageSize]="pageSize"
                              (pageChange)="onPageChange($event)">
                            </app-pagination>
                        </div>
                      </div>
                    }
                }
            </div>
        </div>
    </div>
</main>